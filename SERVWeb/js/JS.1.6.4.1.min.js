
function setGreeting(){$("#lblGreeting").text(greetings[Math.floor(Math.random()*greetings.length)])}function getNextShift(){callServerSide("Service/Service.asmx/GetNextShift","{}",function(e){if(e.d!=null){$("#lblNextShiftDate").text("on "+e.d.EntryDateShortStringWithDay);if(e.d.IsToday){$("#lblNextShiftDate").text("today")}$("#lblNextShiftType").text(e.d.CalendarName);$("#lblNextShift").slideDown()}else{$("#lblNoShift").slideDown()}},function(e){})}function listRecentRuns(){callServerSide("Service/Service.asmx/ListRecentRuns","{}",function(e){var t="<table class='table table-striped table-bordered table-condensed'><tr><th>Recently</th></tr>";for(var n=0;n<e.d.length;n++){t+="<tr><td>"+e.d[n].MemberName+" went to "+e.d[n].DeliverToDestinationName+"</td></tr>"}t+="</table>";$("#recentActivity").append(t);$("#recentActivity").slideDown()},function(e){})}function ImpersonateMember(e){$("#loading").slideDown();callServerSide("Service/Service.asmx/Impersonate","{'memberId':"+e+"}",function(e){window.location.href="Home.aspx"},function(e){niceAlert("Something went wrong.  You may not have sufficient privileges to view other member's details.  If you believe you should, please contact Admin.");$("#loading").slideUp()})}function takeControl(e){$("#loading").slideDown();$("#entry").slideUp();callServerSide("Service/Service.asmx/TakeControl","{'overrideNumber':'"+$("#txtNumber").val()+"'}",function(e){if(e.d==true){$("#success").slideDown();$("#loading").slideUp()}else{niceAlert("Something went wrong!");$("#loading").slideUp()}},function(e){niceAlert("Something went wrong!");$("#loading").slideUp()})}function DisplayMember(e){callServerSide("Service/Service.asmx/GetMember","{'memberId':"+e+"}",function(e){$("#lblTitle").text(e.d.FirstName+" "+e.d.LastName);$("#txtFirstName").val(e.d.FirstName);$("#txtLastName").val(e.d.LastName);$("#txtEmail").val(e.d.EmailAddress);$("#txtMobile").val(e.d.MobileNumber);$("#txtHomePhone").val(e.d.HomeNumber);$("#txtBirthYear").val(e.d.BirthYear);$("#txtAddress1").val(e.d.Address1);$("#txtAddress2").val(e.d.Address2);$("#txtAddress3").val(e.d.Address3);$("#txtTown").val(e.d.Town);$("#txtCounty").val(e.d.County);$("#txtPostCode").val(e.d.PostCode);$("#lnkPostCode").attr("href","http://maps.google.com/maps?saddr="+e.d.PostCode);$("#txtOccupation").val(e.d.Occupation);$("#txtNOK").val(e.d.NextOfKin);$("#txtNOKAddress").val(e.d.NextOfKinAddress);$("#txtNOKPhone").val(e.d.NextOfKinPhone);$("#cboUserLevel").val(e.d.UserLevelID);$("#txtJoinDate").val(e.d.JoinDateString);$("#txtLeaveDate").val(e.d.LeaveDateString);$("#txtAssessmentDate").val(e.d.RiderAssesmentPassDateString);$("#txtAdQualDate").val(e.d.AdQualPassDateString);$("#txtGMPDate").val(e.d.LastGDPGMPDateString);$("#txtAdQualType").val(e.d.AdQualType);$("#txtNotes").val(e.d.Notes);for(var t=0;t<e.d.Tags.length;t++){if(e.d.Tags[t].TagName=="Rider"){$("#chkRider").prop("checked",true)}if(e.d.Tags[t].TagName=="Driver"){$("#chkDriver").prop("checked",true)}if(e.d.Tags[t].TagName=="4x4"){$("#chk4x4").prop("checked",true)}if(e.d.Tags[t].TagName=="EmergencyList"){$("#chkEmergencyList").prop("checked",true)}if(e.d.Tags[t].TagName=="Fundraiser"){$("#chkFundraiser").prop("checked",true)}if(e.d.Tags[t].TagName=="Blood"){$("#chkBlood").prop("checked",true)}if(e.d.Tags[t].TagName=="AA"){$("#chkAA").prop("checked",true)}if(e.d.Tags[t].TagName=="Milk"){$("#chkMilk").prop("checked",true)}if(e.d.Tags[t].TagName=="Water"){$("#chkWater").prop("checked",true)}if(e.d.Tags[t].TagName=="Controller"){$("#chkController").prop("checked",true)}if(e.d.Tags[t].TagName=="OnRota"){$("#chkOnRota").prop("checked",true)}if(e.d.Tags[t].TagName=="Committee"){$("#chkCommittee").prop("checked",true)}}$("#loading").slideUp();$("#entry").slideDown()},function(e){niceAlert("Something went wrong trying to show this member to you.  You may not have sufficient privileges to view other member's details.  If you believe you should, please contact Admin.");$("#loading").slideUp()})}function DisplayLocation(e){callServerSide("Service/Service.asmx/GetLocation","{'locationId':"+e+"}",function(e){$("#lblTitle").text(e.d.LocationName);$("#txtLocationName").val(e.d.LocationName);$("#txtLat").val(e.d.Lat);$("#txtLng").val(e.d.Lng);$("#chkHospital").prop("checked",e.d.Hospital==1);$("#chkChangeOver").prop("checked",e.d.ChangeOver==1);$("#chkBloodBank").prop("checked",e.d.BloodBank==1);$("#loading").slideUp();$("#entry").slideDown();initializeMap()},function(){})}function SaveLocation(e){$("#loading").slideDown();$("#entry").slideUp();var t=JsonifyLocationFromForm(e);callServerSide("Service/Service.asmx/SaveLocation",t,function(e){$("#loading").slideUp();$("#success").slideDown()},function(){$("#loading").slideUp();$("#error").slideDown()})}function JsonifyLocationFromForm(e){return'{"location":{"LocationID":'+e+","+'"LocationName":"'+$("#txtLocationName").val()+'","Hospital":"'+($("#chkHospital").prop("checked")?"1":"0")+'",'+'"Lat":"'+$("#txtLat").val()+'","Lng":"'+$("#txtLng").val()+'",'+'"ChangeOver":"'+($("#chkChangeOver").prop("checked")?"1":"0")+'","BloodBank":"'+($("#chkBloodBank").prop("checked")?"1":"0")+'", "Enabled":"1"}}'}function sendSMSMessage(e,t){$("#loading").slideDown();$("#entry").slideUp();callServerSide("Service/Service.asmx/SendSMSMessage","{'numbers':'"+e+"', 'message':'"+t+"'}",function(e){$("#loading").slideUp();$("#success").slideDown()},function(){})}function getNumbersForTags(e,t){callServerSide("Service/Service.asmx/ListMobileNumbersWithTags","{'tagsCsv':'"+e+"'}",function(e){var n="";for(var r=0;r<e.d.length;r++){n+=e.d[r]+","}$("#"+t).val(n);smsCount=e.d.length;$("#loading").slideUp();$("#lblCount").text(smsCount)},function(){})}function listMembersWithTag(e,t){callServerSide("Service/Service.asmx/ListMembersWithTags","{'tagsCsv':'"+e+"'}",function(e){for(var n=0;n<e.d.length;n++){members[members.length]=e.d[n];memberNames[memberNames.length]=e.d[n].LastName+" "+e.d[n].FirstName}if(t!=null){t()}},function(){})}function getMemberId(e){for(var t=0;t<members.length;t++){if(members[t].LastName+" "+members[t].FirstName==e){return members[t].MemberID}}return 0}function getControllerId(e){for(var t=0;t<controllers.length;t++){if(controllers[t].LastName+" "+controllers[t].FirstName==e){return controllers[t].MemberID}}return 0}function getControllerName(e){for(var t=0;t<controllers.length;t++){if(controllers[t].MemberID==e){return controllers[t].LastName+" "+controllers[t].FirstName}}return 0}function getMemberName(e){for(var t=0;t<members.length;t++){if(members[t].MemberID==e){return members[t].LastName+" "+members[t].FirstName}}return""}function getLocationId(e){for(var t=0;t<locations.length;t++){if(locations[t].LocationName==e){return locations[t].LocationID}}return 0}function getLocationName(e){for(var t=0;t<locations.length;t++){if(locations[t].LocationID==e){return locations[t].LocationName}}return 0}function GetSMSCreditCount(e){callServerSide("Service/Service.asmx/GetSMSCreditCount","{}",function(t){$("#"+e).text(t.d)},function(){})}function listControllers(e){callServerSide("Service/Service.asmx/ListMembersWithTags","{'tagsCsv':'controller'}",function(t){for(var n=0;n<t.d.length;n++){controllers[controllers.length]=t.d[n];controllerNames[controllerNames.length]=t.d[n].LastName+" "+t.d[n].FirstName}if(e!=null){e()}},function(){})}function writeMembersWithTagAsListItems(e,t,n){callServerSide("Service/Service.asmx/ListMembersWithTags","{'tagsCsv':'"+e+"'}",function(e){for(var r=0;r<e.d.length;r++){$("#"+t).append('<li id="'+t+r+'"><a>'+e.d[r].FirstName+" "+e.d[r].LastName+"</a></li>");$("#"+t+r).click({param1:e.d[r]},function(e){n(e.data.param1.MemberID,e.data.param1.FirstName,e.data.param1.LastName)})}},function(){})}function writeLocations(e,t){for(var n=0;n<locations.length;n++){$("#"+e).append('<li id="'+e+n+'"><a>'+locations[n].LocationName+"</a></li>");$("#"+e+n).click({param1:locations[n]},function(e){t(e.data.param1.LocationID,e.data.param1.LocationName,e.data.param1.Hospital,e.data.param1.ChangeOver,e.data.param1.BloodBank)})}}function listLocations(e){callServerSide("Service/Service.asmx/ListLocations","{}",function(t){for(var n=0;n<t.d.length;n++){locations[locations.length]=t.d[n];locationNames[locationNames.length]=t.d[n].LocationName}if(e!=null){e()}},function(){})}function writeVehicleTypes(e,t){callServerSide("Service/Service.asmx/ListVehicleTypes","{}",function(n){for(var r=0;r<n.d.length;r++){$("#"+e).append('<li id="'+e+r+'"><a>'+n.d[r].VehicleTypeName+"</a></li>");$("#"+e+r).click({param1:n.d[r]},function(e){t(e.data.param1.VehicleTypeID,e.data.param1.VehicleTypeName)})}},function(){})}function SearchMembers(e,t,n){$("#results").text("");callServerSide("Service/Service.asmx/SearchMembers","{'search':'"+t+"', 'onlyActive':"+n+"}",function(t){var n='<table class="table table-striped table-bordered table-condensed">'+"<thead><tr><th></th><th>First Name</th><th>Last Name</th><th>Mobile</th><th>Town</th><th>Tags</th><th>User Level</th></tr></thead><tbody>";for(var r=0;r<t.d.length;r++){var i=t.d[r].LastName;if(e>=3){i='<a href="ViewMember.aspx?memberId='+t.d[r].MemberID+'">'+i+"</a>"}var s="<tr><td>"+(r+1)+"</td><td>"+t.d[r].FirstName+"</td>"+"<td>"+i+"</td>"+"<td nowrap>"+t.d[r].MobileNumber+"</td>"+"<td>"+t.d[r].Town+"</td>"+"<td nowrap><small>"+t.d[r].TagsText+"</small></td>"+"<td>"+t.d[r].UserLevelName+"</td>"+"</tr>";n+=s}n+="</tbody></table>";$("#results").append(n);$("#loading").slideUp();$("#entry").slideDown()},function(){})}function ListLocations(e){callServerSide("Service/Service.asmx/ListLocations","{}",function(e){var t='<table class="table table-striped table-bordered table-condensed">'+"<thead><tr><th></th><th>Location</th><th>Bloodbank</th><th>Handover</th><th>Hospital</th><th>Lat</th><th>Lng</th></tr></thead><tbody>";for(var n=0;n<e.d.length;n++){var r='<a href="ViewLocation.aspx?locationId='+e.d[n].LocationID+'">'+e.d[n].LocationName+"</a>";var i="<tr><td>"+(n+1)+"</td><td>"+r+"</td>"+"<td>"+(e.d[n].BloodBank?"X":"")+"</td>"+"<td>"+(e.d[n].ChangeOver?"X":"")+"</td>"+"<td>"+(e.d[n].Hospital?"X":"")+"</td>"+"<td>"+(e.d[n].Lat?e.d[n].Lat.substr(0,8):"???")+"</td>"+"<td>"+(e.d[n].Lng?e.d[n].Lng.substr(0,8):"???")+"</td>"+"</tr>";t+=i}t+="</tbody></table>";$("#results").append(t);$("#loading").slideUp();$("#entry").slideDown()},function(){})}function addMemberTag(e,t){$("#loading").slideDown();callServerSide("Service/Service.asmx/TagMember","{'memberId':"+e+", 'tagName': '"+t+"'}",function(e){$("#loading").slideUp()},function(){$("#loading").slideUp();$("#entry").slideUp();$("#error").slideDown()})}function setMemberUserLevel(e,t){$("#loading").slideDown();callServerSide("Service/Service.asmx/SetMemberUserLevel","{'memberId':"+e+", 'userLevelId': "+t+"}",function(e){$("#loading").slideUp()},function(){$("#loading").slideUp();$("#entry").slideUp();$("#error").slideDown()})}function removeMemberTag(e,t){$("#loading").slideDown();callServerSide("Service/Service.asmx/UnTagMember","{'memberId':"+e+", 'tagName': '"+t+"'}",function(e){$("#loading").slideUp()},function(){$("#loading").slideUp();$("#entry").slideUp();$("#error").slideDown()})}function SaveBasicMember(e){$("#loading").slideDown();$("#entry").slideUp();var t=JsonifyBasicMemberFromForm(e);callServerSide("Service/Service.asmx/SaveMember",t,function(e){$("#loading").slideUp();$("#success").slideDown()},function(){$("#loading").slideUp();$("#error").slideDown()})}function JsonifyBasicMemberFromForm(e){return'{"member":{"MemberID":'+e+","+'"FirstName":"'+$("#txtFirstName").val()+'","LastName":"'+$("#txtLastName").val()+'",'+'"EmailAddress":"'+$("#txtEmail").val()+'","MobileNumber":"'+$("#txtMobile").val()+'",'+'"HomeNumber":"'+$("#txtHomePhone").val()+'","Occupation":"'+$("#txtOccupation").val()+'",'+'"Address1":"'+$("#txtAddress1").val()+'","Address2":"'+$("#txtAddress2").val()+'",'+'"Address3":"'+$("#txtAddress3").val()+'",'+'"Town":"'+$("#txtTown").val()+'","County":"'+$("#txtCounty").val()+'",'+'"PostCode":"'+$("#txtPostCode").val()+'",'+'"BirthYear":'+$("#txtBirthYear").val()+',"NextOfKin":"'+$("#txtNOK").val()+'",'+'"NextOfKinAddress":"'+$("#txtNOKAddress").val()+'",'+'"NextOfKinPhone":"'+$("#txtNOKPhone").val()+'", '+'"JoinDateString":"'+$("#txtJoinDate").val()+'", '+'"LeaveDateString":"'+$("#txtLeaveDate").val()+'", '+'"RiderAssesmentPassDateString":"'+$("#txtAssessmentDate").val()+'", '+'"AdQualPassDateString":"'+$("#txtAdQualDate").val()+'", '+'"LastGDPGMPDateString":"'+$("#txtGMPDate").val()+'", '+'"AdQualType":"'+$("#txtAdQualType").val()+'", '+'"Notes":"'+$("#txtNotes").val()+'"}}'}function register(){if(validateRegistrationForm()){$("#loading").slideDown();$("#entry").slideUp();var e=JsonifyBasicMemberFromForm(-1);callServerSide("Service/Service.asmx/Register",e,function(e){var t=e.d;if(t>0){if($("#chkRider").prop("checked")==true){callServerSide("Service/Service.asmx/TagMember","{'memberId':"+t+", 'tagName': 'Rider'}",function(e){},function(){})}if($("#chkDriver").prop("checked")==true){callServerSide("Service/Service.asmx/TagMember","{'memberId':"+t+", 'tagName': 'Driver'}",function(e){},function(){})}if($("#chk4x4").prop("checked")==true){callServerSide("Service/Service.asmx/TagMember","{'memberId':"+t+", 'tagName': '4x4'}",function(e){},function(){})}if($("#chkEmergencyList").prop("checked")==true){callServerSide("Service/Service.asmx/TagMember","{'memberId':"+t+", 'tagName': 'EmergencyList'}",function(e){},function(){})}if($("#chkFundraiser").prop("checked")==true){callServerSide("Service/Service.asmx/TagMember","{'memberId':"+t+", 'tagName': 'Fundraiser'}",function(e){},function(){})}$("#loading").slideUp();$("#success").slideDown();niceAlert("Thank you "+$("#txtFirstName").val()+". Someone will be in touch with you very soon to arrange the next steps.  The system will send you your password by email now.")}else{$("#loading").slideUp();$("#error").slideDown();$("#entry").slideDown();if(t==-1){niceAlert("We already have a member with that email address!")}}},function(){$("#loading").slideUp();$("#error").slideDown();$("#entry").slideDown()})}}function validateRegistrationForm(){$("#error").slideUp();if($("#chkAgree").prop("checked")!=true){niceAlert("Please confirm that your vehicle is safe & road legal and that you have read and understood the membership code of practice");return false}if($("#txtFirstName").val()==""||$("#txtLastname").val()==""||$("#txtEmail").val()==""||$("#txtMobile").val()==""||$("#txtAddress1").val()==""||$("#txtPostCode").val()==""||$("#txtTown").val()==""||$("#txtBirthYear").val()==""){niceAlert("Please fill in all the fields");return false}if($("#txtMobile").val().substring(0,2)!="07"){niceAlert("Please enter a valid mobile number");return false}if($("#txtEmail").val().indexOf("@")==-1||$("#txtEmail").val().indexOf(".")==-1){niceAlert("Please enter a valid email address");return false}return true}function keepAlive(){callServerSide("Service/Service.asmx/KeepAlive","{}",function(e){$("#icoSessionStatus").removeClass("icon-red");$("#icoSessionStatus").removeClass("icon-green");window.setTimeout('$("#icoSessionStatus").addClass("icon-green");',500);window.setTimeout("keepAlive()",2e4)},promptForLogin)}function promptForLogin(){$("#icoSessionStatus").removeClass("icon-green");$("#icoSessionStatus").addClass("icon-red");niceAlert("Session error!! This should not happen, but it did.  Open a new tab and login to the SERV system again.  If you are attempting to make a sumbission, for example logging a run, you NEED to log back in before that will work.  There is no need to close this tab and lose your work.");window.setTimeout("keepAlive()",4e4)}function isValidTime(e){if(e.length!=5){return false}if(e.indexOf(":")==-1&&e.indexOf(".")==-1){return false}if(e.indexOf("-")!=-1){return false}if(e.indexOf("+")!=-1){return false}return true}function niceAlert(e){$("#alertMessage").text(e);$("#alert").dialog({modal:true,dialogClass:"no-close",autoOpen:true,show:{effect:"shake",duration:100},hide:{effect:"slide",duration:100},buttons:[{text:"OK",click:function(){$(this).dialog("close")}}]})}function callServerSide(e,t,n,r){$.ajax({type:"POST",url:e,data:t,async:asyncRequests,contentType:"application/json; charset=utf-8",dataType:"json",success:n,error:r})}var asyncRequests=true;var FullName="";var locations=new Array;var locationNames=new Array;var members=new Array;var memberNames=new Array;var controllers=new Array;var controllerNames=new Array;var greetings=new Array("Hi","Greetings","Well Hello","Sup","Wagwan","Haai","Hola","Hej","Konnichiwa","Zdravstvujte","Yo","Howdy","Hiya","Good day to you","Oh, Hi")